<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Blog - Rohan Jain</title>
        <meta name="author" content="Rohan Jain">
        <meta charset=utf-8>

        <!-- Favicon -->
        <link href="/favicon.ico" rel="shortcut icon"/>

        <!--Stylesheets-->
        <link rel="stylesheet" media="screen" type="text/css" href="/css/style.css"/>
        <link rel="stylesheet" media="screen" type="text/css" href="/css/syntax.css"/>

        <!--Atom Feed-->
        <link rel="alternate" type="application/atom+xml" title="Atom" href="/atom.xml"/>

        <!-- Scripts-->
        <script type="text/javascript" src="/js/head.min.js"></script>
        <script type="text/javascript">
            //Google analytics
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-15806710-5']);
            _gaq.push(['_trackPageview']);

            //Disqus
            var disqus_shortname = 'crodjer';
            
            head.js(
                "http://www.google-analytics.com/ga.js",
                "https://apis.google.com/js/plusone.js"
            );
            
            head.js("http://crodjer.disqus.com/count.js");
            
        </script>
  </head>
  <body>
      <div id="header">
    <span class="byline">what crodjer has to say...</span>
    <h1><a href="/">Rohan Jain</a></h1>
</div>

<div id="content">
    <div class="posts">
    
    <div class="post">
    <h2 class="post-title" id="django-using-admin-horizontal-filter-in-forms"><a href="/coding/2011/06/20/django-using-admin-horizontal-filter-in-forms/">Django using admin horizontal filter in forms</a></h2>
<div class="meta">
    <span class="date">
        <img alt="Posted on" src="/images/calendar.png"/> 20 Jun, 2011
    </span>
    <span class="share">
        <g:plusone size="small" href="http://www.rohanjain.in/coding/2011/06/20/django-using-admin-horizontal-filter-in-forms/"></g:plusone>&nbsp;
    </span>
    <span class="tags" >
        
        <img alt="Tags" src="/images/tag.png"/>
        
        <a href="/tags/django">django</a>
        
        <a href="/tags/widget">widget</a>
        
        <a href="/tags/snipet">snipet</a>
        
        
    </span>

    <a class="comments" href="/coding/2011/06/20/django-using-admin-horizontal-filter-in-forms/#disqus_thread" data-disqus-identifier="django-using-admin-horizontal-filter-in-forms">Comments</a>
</div>


    <div class='post-text'>
        
        <p>The django admin filter horizontal/vertical widgets are a really cool
replacement of the inconvenient and ugly default multiple select elements.</p>

<p><img src="/images/posts/hor_filter_dj.png" alt="Django admin filter used in auth" /></p>

<p><em>But how do I get these in my normal forms?</em><br />
This is how:</p>

<p>First create a django form with <code>ModelMultipleChoiceField</code> and <code>FilterSelectMultiple</code>
as widget. To get this to work you need to add some extra media files. Here
is the snipet:</p>

<p><em>forms.py</em></p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.contrib.admin.widgets</span> <span class="kn">import</span> <span class="n">FilteredSelectMultiple</span>

<span class="k">class</span> <span class="nc">TagForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelMultipleChoiceField</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                                          <span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Select tags&#39;</span><span class="p">),</span>
                                          <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                          <span class="n">widget</span><span class="o">=</span><span class="n">FilteredSelectMultiple</span><span class="p">(</span>
                                                    <span class="n">_</span><span class="p">(</span><span class="s">&#39;tags&#39;</span><span class="p">),</span>
                                                    <span class="bp">False</span><span class="p">,</span>
                                                 <span class="p">))</span>

    <span class="k">class</span> <span class="nc">Media</span><span class="p">:</span>
        <span class="n">css</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;all&#39;</span><span class="p">:[</span><span class="s">&#39;admin/css/widgets.css&#39;</span><span class="p">,</span>
                   <span class="s">&#39;css/uid-manage-form.css&#39;</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="n">js</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/admin/jsi18n/&#39;</span><span class="p">]</span>
</code></pre>
</div>

<p>Add form media and form in the template.</p>

<div class="highlight"><pre><code class="django"><span class="x">&lt;!--HEAD --&gt;</span>
<span class="cp">{{</span> <span class="nv">form.media</span> <span class="cp">}}</span><span class="x" />
<span class="x">&lt;!--BODY--&gt;</span>
<span class="cp">{{</span> <span class="nv">form</span> <span class="cp">}}</span><span class="x" />
</code></pre>
</div>

<p>This extra css fixes some layout problems</p>

<div class="highlight"><pre><code class="css"><span class="nc">.selector</span><span class="p">{</span>
    <span class="k">float</span><span class="o">:</span><span class="k">none</span><span class="p">;</span>
    <span class="k">display</span><span class="o">:</span><span class="k">block</span><span class="p">;</span>
    <span class="k">height</span><span class="o">:</span><span class="m">330px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.selector</span> <span class="nt">input</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="o">]</span><span class="p">{</span>
    <span class="k">display</span><span class="o">:</span><span class="k">block</span><span class="p">;</span>
    <span class="k">clear</span><span class="o">:</span><span class="k">both</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.selector</span> <span class="nt">h2</span><span class="p">{</span>
    <span class="k">font-size</span><span class="o">:</span><span class="m">15px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.selector</span>  <span class="nt">select</span><span class="p">{</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">2px</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">2px</span> <span class="m">3px</span><span class="p">;</span>
    <span class="k">font-weight</span><span class="o">:</span> <span class="k">normal</span><span class="p">;</span>
    <span class="k">width</span><span class="o">:</span> <span class="m">270px</span> <span class="cp">!important</span><span class="p">;</span>
    <span class="k">height</span><span class="o">:</span> <span class="m">17.2em</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">textarea</span><span class="p">{</span>
    <span class="k">display</span><span class="o">:</span><span class="k">block</span><span class="p">;</span>
    <span class="k">width</span><span class="o">:</span><span class="m">450px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Refrences: <a href="http://j.mp/mAzALa">http://j.mp/mAzALa</a>, <a href="http://j.mp/lIG2Fl">http://j.mp/lIG2Fl</a><br />
I decided to create another post for this because, none of these suggests
the use of admin widget directly.</p>

        
    </div>
</div>

    
    <div class="post">
    <h2 class="post-title" id="dynamic-to-static"><a href="/personal/2011/06/16/dynamic-to-static/">Dynamic to Static</a></h2>
<div class="meta">
    <span class="date">
        <img alt="Posted on" src="/images/calendar.png"/> 16 Jun, 2011
    </span>
    <span class="share">
        <g:plusone size="small" href="http://www.rohanjain.in/personal/2011/06/16/dynamic-to-static/"></g:plusone>&nbsp;
    </span>
    <span class="tags" >
        
        <img alt="Tags" src="/images/tag.png"/>
        
        <a href="/tags/jekyll">jekyll</a>
        
        <a href="/tags/blog">blog</a>
        
        <a href="/tags/VIM">VIM</a>
        
        
    </span>

    <a class="comments" href="/personal/2011/06/16/dynamic-to-static/#disqus_thread" data-disqus-identifier="dynamic-to-static">Comments</a>
</div>


    <div class='post-text'>
        
        <p>I just shifted my website to Jekyll static pages, from the completely
dynamic <em>django</em> based and database oriented <a href="http://old.rohanjain.in">old one</a>.
The factor which drove this decision: <strong>VIM</strong> period.</p>

<p>I did not put up much on the old site because I couldn’t post directly from
my offline editor to posts there. The functionalities that were present over
there were to much overkill and completely invisible to the public, so better
save the processing power required to render the content every time the
page is accessed.</p>

<p>After the setting up of this, I expect a considerable increase in my
blogging frequency.</p>

        
    </div>
</div>

    
    <div class="post">
    <h2 class="post-title" id="building-my-power-computer"><a href="/personal/2011/04/22/building-my-power-computer/">Building my power computer</a></h2>
<div class="meta">
    <span class="date">
        <img alt="Posted on" src="/images/calendar.png"/> 22 Apr, 2011
    </span>
    <span class="share">
        <g:plusone size="small" href="http://www.rohanjain.in/personal/2011/04/22/building-my-power-computer/"></g:plusone>&nbsp;
    </span>
    <span class="tags" >
        
        <img alt="Tags" src="/images/tag.png"/>
        
        <a href="/tags/desktop">desktop</a>
        
        <a href="/tags/laptop">laptop</a>
        
        <a href="/tags/configuration">configuration</a>
        
        
    </span>

    <a class="comments" href="/personal/2011/04/22/building-my-power-computer/#disqus_thread" data-disqus-identifier="building-my-power-computer">Comments</a>
</div>


    <div class='post-text'>
        
        <p>I have been using laptops as working machines for 3 years now. With my ancient
C2D 2GHz, I can’t play games (I don’t anyways but still), use powerfull
applications and am able to <strong>blink my eyes</strong> (much more than once sometimes)
for most of the executions. This asks for system upgrades. But wait! upgrade
and laptop seem to be mutually exclusive. Now this is bad. I think <em>What is
the reason to buy laptops?</em>. I find only one: <strong>Portablity</strong>. But is it really
worth spending <strong>lots</strong> of extra bucks just to achieve portability, which too
come at price of way lower configuration? Aren’t tablets the one for portability?  </p>

<p>Looking for a good laptop around, I found to get one with i7 drains around
90k-100k Rs and still the configuration will be way low end against the one
I can get according to below one of a desktop. So I get a really powerfull
desktop and save up enough to get a good Tablet for portability.</p>

<p>Complete configuration details at my old website <a href="http://old.rohanjain.in/">http://old.rohanjain.in/</a></p>

        
    </div>
</div>

    
    <div class="post">
    <h2 class="post-title" id="hosting-multiple-sites-with-same-django-project"><a href="/coding/2010/12/24/hosting-multiple-sites-with-same-django-project/">Hosting multiple sites with same django project</a></h2>
<div class="meta">
    <span class="date">
        <img alt="Posted on" src="/images/calendar.png"/> 24 Dec, 2010
    </span>
    <span class="share">
        <g:plusone size="small" href="http://www.rohanjain.in/coding/2010/12/24/hosting-multiple-sites-with-same-django-project/"></g:plusone>&nbsp;
    </span>
    <span class="tags" >
        
        <img alt="Tags" src="/images/tag.png"/>
        
        <a href="/tags/django">django</a>
        
        <a href="/tags/hosting">hosting</a>
        
        
    </span>

    <a class="comments" href="/coding/2010/12/24/hosting-multiple-sites-with-same-django-project/#disqus_thread" data-disqus-identifier="hosting-multiple-sites-with-same-django-project">Comments</a>
</div>


    <div class='post-text'>
        
        <p>The first thing the title triggers in the mind is the django <a href="http://docs.djangoproject.com/en/dev/ref/contrib/sites/">sites framework</a>. Well this post is mostly related to that but suggests its utilization in slight different way. As we can get from the docs in every implementation of the sites framework you have to hardcode the SITE_ID in your settings.py file. So it assumes that you have multiple django projects or at least multiple settings.py files which will be used as the django settings module for the process. So basically it provides us to share database between multiple sites which is a nice feature.  </p>

<p>For our case which is, we want to use a single django project to across multiple domains while presenting altered versions of content dependant on the originating domain (the domain names cannot be hardcoded as the number of domains is dynamic too.), we have to do something different to get this level of dynamicity. I did sone research about this on the <strong>#django</strong> IRC, <strong>stackoverflow</strong> and <strong>google</strong>. Here are some complete/incomplete ways I found out to achieve this.</p>

<h3 id="using-custom-apps-and-modules">Using custom apps and modules</h3>
<p>These ways would need us to define many custom models and middleware, hence a lot of work. The domain management would be done by the django project itself through middleware which use the HTTP_REQUST header and hence every request will be processed to obtain the information required to do database queries and render the views. So these methods looks like bit safer but would cause a performance decrease. </p>

<h4 id="modify-contrib">Modify contrib</h4>
<p>This is the rather easier way which involves modifications of code of some django contrib apps here and there. 
Just copy the apps from django-&gt;contrib folder to the project directory and modify them to accept request as argument give out results according to the HTTP_HOST and Sites database. Also change all the imo reference of these apps from <em>django.contrib.app</em> to <em>app</em>.</p>

<h4 id="forget-contrib">Forget contrib</h4>
<p>Another way would be to forget the contrib apps and write your own custom similar ones from scratch. This may be a better way for long term projects which require highly customized and special functionalities. But it will require us to write a lot of code, though the existing modules can be used for reference. </p>

<h3 id="using-unaltered-django-modules">Using unaltered django modules</h3>
<p>If we are successful in doing this it will probably let us build our project in much less lines of code and using the already existent django contribs as is. So if we don’t modify django modules then what do we modify to achieve the dynamicity. </p>

<h4 id="wsgi">.wsgi</h4>
<p>This is what we could do: First define multiple settings files in some pattern so that they can be matched according to the domain name, say <em>settings_domain.py</em>. Now if the deployment is done using wsgi script (generally in <a href="http://docs.djangoproject.com/en/dev/howto/deployment/modwsgi/">this</a>) format. In the wsgi script we have to call the respective settings_domain.py according to the accessing domain name. So this seems pretty good but it can be dangerous. As we are setting a global variable (<code>os.environ['DJANGO_SETTINGS_MODULE']</code>) it is not at all a <strong>thread safe</strong> method. If there are two requests close enough this may pose dangerous effects. Unless we are not able to make sure that a new fork / new wsgi demon will be created per domain. So maybe one could suggest to write a good wsgi script which could handle this.</p>

<h4 id="htaccess">.htaccess</h4>
<p>Yet another way would be to make the .htaccess file dynamic, if it is possible. I don’t have any idea if I could write an apache config file that would trigger the correct wsgi file (which triggers the correct settings one). Maybe one could suggest a way of doing this (through regex?). To me thiss seems the best way which would trigger a corresponding process for each domain.</p>

<h4 id="django-multisite">django-multisite</h4>
<p>This is a django application I found (Source: https://github.com/shestera/django-multisite) which utilize <strong>thread locals</strong> to dynamically define the SITE_ID setting according to the request domain. I have tried this and is actually working but as the django documentation has <a href="http://code.djangoproject.com/wiki/CookBookThreadlocalsAndUser">pretty clearly</a> warned against its use, I am in doubt if it is a safe way. </p>

<p>Till now I am still unclear of what method to implement among the above or some other one. There are some pros and cons of all the methods.  </p>

<p>I apologise if I have written something wrong, these all are only some methods I have found out while searching the web and discussing on the groups, so please specify if there is any mistake or you can suggest something related to this.</p>

        
    </div>
</div>

    
</div>

<div class="paginator">
    
    <span class="previous">Previous</span>
    
    <span class="page_number ">Page: 1 of 2</span>
    
    <a href="/page2" class="next ">Next</a>
    
</div>

</div>

<div id="sidebar">
    <ul>
        <li><a href="/">Blog</a></li>
        <li><a href="/about">About Me</a></li>
        <li><a href="/archive">Archive</a></li>
    </ul>
</div>

<div id="footer">
    <p>
        <a rel="license" href="http://creativecommons.org/licenses/by/3.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by/3.0/80x15.png" /></a>
        Using <a href="http://jekyllrb.com/">Jekyll</a>,
        <a href="http://pygments.org/">Pygments</a>
        | <a href="/sitemap.xml">Sitemap</a>, <a href="/feed.xml">Feed</a>
    </p>
</div>

 </body>
</html>
