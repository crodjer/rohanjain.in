<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="google-site-verification" content="iVLOY09LTW8dfYg1-bEVDAMFBIPsb_VNNWRAJjQw5Is" />
    <meta name="description" content="A web blog, by Rohan Jain" />
    <meta name="author" content="Rohan Jain" />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Emacs: Flymake with virtualenvs in python-mode | The Perpetual Amateur</title>
    <link href="../favicon.ico" rel="icon" />
    <link rel="alternate" type="application/atom+xml" title="Rohan's Weblog" href="../feed.xml" />

    <!-- Bootstrap core CSS -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">


    <!-- Custom styles for this template -->
    <link href="../static/css/default.css" rel="stylesheet" />
    <link href="../static/css/highlight.css" rel="stylesheet" />

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script>
      if (typeof(localStorage) === 'object' && localStorage.noAnalytics !== "true") {
        // Google analytics
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-15806710-5', 'auto');
        ga('send', 'pageview');
      }
    </script>
  </head>

  <body>
    <div class="container">
      <div class="header clearfix">
        <nav>
          <ul class="nav nav-pills">
            <a class="superTitle" href="../">
              The Perpetual Amateur
            </a>
            <a class="mobileLink" href="../">
              Home
            </a>
            <a class="mobileLink" href="../about/">
              About
            </a>
          </ul>
        </nav>
        <h1 class="text-muted">Emacs: Flymake with virtualenvs in python-mode</h1>
      </div>

      <div id="content">
        <div class="meta">
  <em class="date">January 28, 2014</em>
  
  |
  <span class="tags"><a href="../tags/emacs/">emacs</a>, <a href="../tags/python/">python</a></span>
  
</div>

<div class="post">
  <p>Lately, I have been writing some python with emacs. So, I have been trying to get the popular checkers (<code>pylint</code>/<code>pyflakes</code>) to work with flymake and virtualenvs. The issues with existing solutions to get flymake working with the checkers is that most of them assume a global version of executable (which would be fine if it werenâ€™t for the whole python 2 and 3 incompatibility).</p>
<p>The <code>python-mode</code> in the latest emacs versions (mine is <code>24.3.1</code>) includes a basic support for <code>virtualenvs</code>. I run <code>pylint/pyflakes</code> through the command <code>env</code> with the environment variables calculated from the functions provided by <code>python-mode</code>. Here is the code extracted from my <a href="https://github.com/crodjer/configs/blob/master/.emacs">emacs configuration</a>:</p>
<pre class="elisp"><code>(defun python-calculate-env ()
  &quot;Calculate env variables for current python virtualenv.&quot;
  ;; ;; This also overrides PYTHONHOME to &quot;&quot;, which breaks the process
  ;; ;; environment. Otherwise, a neat idea.
  ;; (mapcar
  ;;  (lambda (string)
  ;;    (let ((splitted-string (split-string string &quot;=&quot;)))
  ;;      (format
  ;;       &quot;%s=\&quot;%s\&quot;&quot;
  ;;       (car splitted-string)
  ;;       (or (cadr splitted-string)
  ;;           &quot;&quot;))))
  ;; (python-shell-calculate-process-environment)))
  (remove-if
   (lambda (x)
     (or
      ;; If environment
      (string-match &quot; &quot; x)
      (not (string-match &quot;=&quot; x))))
   (python-shell-calculate-process-environment)))

(defun python-virtualenv-exec (command args)
  &quot;Generate a flymake friendly list executable in virtualenv, for provided
commands.&quot;
  (list &quot;env&quot; (append (python-calculate-env) (list command) args)))

(when (load &quot;flymake&quot; t)
  (defun flymake-python-init ()
    (let* ((temp-file (flymake-init-create-temp-buffer-copy
                       'flymake-create-temp-inplace))
           (local-file (file-relative-name
                        temp-file
                        (file-name-directory buffer-file-name))))
      (python-virtualenv-exec
       &quot;pylint&quot;
       (list
        ;; Pylint args. Will depend on the checker being used.
        &quot;-r&quot; &quot;n&quot;
        &quot;--msg-template='{path}:{line}:{category} [{msg_id} {obj}] {msg}'&quot;
        local-file))))
  (add-to-list 'flymake-allowed-file-name-masks
             '(&quot;\\.py\\'&quot; flymake-python-init)))

(defun flymake-mode-hook-function ()
  (when (derived-mode-p 'python-mode)
    (flymake-mode t)))
;; Run flymake mode hook function after the local variables are set (eg: through
;; .dir-locals.el
(add-hook 'hack-local-variables-hook #'flymake-mode-hook-function)
(setq virtualenv-workon-starts-python nil)</code></pre>


</div>
<em class="meta">
  Any suggestions for the post? You may send me a pull request
  <a href="https://github.com/crodjer/rohanjain.in/tree/master/posts/2014/emacs-flymake-with-virtualenvs-in-python-mode.mkd">here</a>.
</em>
<!--

<div class="comments">
  <div id="disqus_thread"></div>

  <script type="text/javascript">

    //Disqus
    var disqus_shortname = 'crodjer';

    var disqus_identifier = 'posts/2014/emacs-flymake-with-virtualenvs-in-python-mode.mkd';
    var disqus_title = 'Emacs: Flymake with virtualenvs in python-mode';

  </script>
  <script src="http://crodjer.disqus.com/embed.js"></script>
</div>

-->

      </div>

      <footer class="footer">
        <a class="link" href="../">Home</a>
        <a class="link" href="../about/">About</a>
        <a class="link" href="../feed.xml">Feed</a>
        <a class="link" href="https://github.com/crodjer">GitHub</a>

        <span class="credits">
          Site proudly generated with
          <a href="http://github.com/jaspervdj/hakyll">Hakyll</a>.
        </span>
      </footer>
    </div> <!-- /container -->

    <a href="https://github.com/crodjer" class="gh-banner">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/a6677b08c955af8400f44c6298f40e7d19cc5b2d/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" />
    </a>

  </body>

  <script src="//cdnjs.cloudflare.com/ajax/libs/turbolinks/1.3.0/turbolinks.min.js">
  </script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js">
  </script>
  <script>
    document.addEventListener('page:fetch', function() {
      NProgress.start();
    });
    document.addEventListener('page:change', function() {
      NProgress.done();
    });
    document.addEventListener('page:restore', function() {
      NProgress.remove();
    });
  </script>
</html>
