<!doctype html><html lang=en-US><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=author content="Rohan Jain"><meta name=description content="Emacs: Flymake with virtualenvs in python-mode | Rohan's Personal Web Blog."><meta property="og:title" content="Emacs: Flymake with virtualenvs in python-mode"><meta property="og:type" content="article"><meta property="article:published_time" content="2014-01-28T00:00:00+00:00"><meta property="article:modified_time" content="2014-01-28T00:00:00+00:00"><title>Emacs: Flymake with virtualenvs in python-mode</title><link rel=canonical href=/emacs-flymake-with-virtualenvs-in-python-mode/><link rel=stylesheet href=/css/main.min.97ffe0e39b9819392033e2635f05ec47c705d94936b7483bb66889dbf15d7a90.css><link rel="shortcut icon" href=/img/favicon.ico><script>let FF_FOUC_FIX</script></head><body lang=en><header><a href=/>The Perpetual Amature</a><nav><ul><li><a href=/>Home</a></li><li><a href=/about/>About</a></li></ul></nav></header><main><h1>Emacs: Flymake with virtualenvs in python-mode</h1><p>Lately, I have been writing some python with emacs. So, I have been trying to
get the popular checkers (<code>pylint</code>/<code>pyflakes</code>) to work with flymake and
virtualenvs. The issues with existing solutions to get flymake working with the
checkers is that most of them assume a global version of executable (which would
be fine if it weren&rsquo;t for the whole python 2 and 3 incompatibility).</p><p>The <code>python-mode</code> in the latest emacs versions (mine is <code>24.3.1</code>) includes a
basic support for <code>virtualenvs</code>. I run <code>pylint/pyflakes</code> through the command
<code>env</code> with the environment variables calculated from the functions provided by
<code>python-mode</code>. Here is the code extracted from my
<a href=https://github.com/crodjer/configs/blob/master/.emacs>emacs configuration</a>:</p><pre><code class=language-elisp>(defun python-calculate-env ()
  &quot;Calculate env variables for current python virtualenv.&quot;
  ;; ;; This also overrides PYTHONHOME to &quot;&quot;, which breaks the process
  ;; ;; environment. Otherwise, a neat idea.
  ;; (mapcar
  ;;  (lambda (string)
  ;;    (let ((splitted-string (split-string string &quot;=&quot;)))
  ;;      (format
  ;;       &quot;%s=\&quot;%s\&quot;&quot;
  ;;       (car splitted-string)
  ;;       (or (cadr splitted-string)
  ;;           &quot;&quot;))))
  ;; (python-shell-calculate-process-environment)))
  (remove-if
   (lambda (x)
     (or
      ;; If environment
      (string-match &quot; &quot; x)
      (not (string-match &quot;=&quot; x))))
   (python-shell-calculate-process-environment)))

(defun python-virtualenv-exec (command args)
  &quot;Generate a flymake friendly list executable in virtualenv, for provided
commands.&quot;
  (list &quot;env&quot; (append (python-calculate-env) (list command) args)))

(when (load &quot;flymake&quot; t)
  (defun flymake-python-init ()
    (let* ((temp-file (flymake-init-create-temp-buffer-copy
                       'flymake-create-temp-inplace))
           (local-file (file-relative-name
                        temp-file
                        (file-name-directory buffer-file-name))))
      (python-virtualenv-exec
       &quot;pylint&quot;
       (list
        ;; Pylint args. Will depend on the checker being used.
        &quot;-r&quot; &quot;n&quot;
        &quot;--msg-template='{path}:{line}:{category} [{msg_id} {obj}] {msg}'&quot;
        local-file))))
  (add-to-list 'flymake-allowed-file-name-masks
             '(&quot;\\.py\\'&quot; flymake-python-init)))

(defun flymake-mode-hook-function ()
  (when (derived-mode-p 'python-mode)
    (flymake-mode t)))
;; Run flymake mode hook function after the local variables are set (eg: through
;; .dir-locals.el
(add-hook 'hack-local-variables-hook #'flymake-mode-hook-function)
(setq virtualenv-workon-starts-python nil)
</code></pre></main><footer><a href=/blog>All Posts</a>
<a href=//github.com/crodjer target=_blank rel=noopener>Github</a>
<a href=//linkedin.com/in/crodjer target=_blank rel=noopener>Linkedin</a>
<a href=//twitter.com/__crodjer__ target=_blank rel=noopener>Twitter</a></footer><script data-goatcounter=https://t.rohanjain.in/count async src=/js/count.min.4e3257a9873dba863f309fe89287c9f6e962d7be1758704f13b2608e58008e5f.js></script><noscript><img src="https://t.rohanjain.in/count?p=%2femacs-flymake-with-virtualenvs-in-python-mode%2f&t=Emacs%3a%20Flymake%20with%20virtualenvs%20in%20python-mode"></noscript></body></html>