<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="google-site-verification" content="iVLOY09LTW8dfYg1-bEVDAMFBIPsb_VNNWRAJjQw5Is" />
    <meta name="description" content="A web blog, by Rohan Jain" />
    <meta name="author" content="Rohan Jain" />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>VNC over reverse SSH | The Perpetual Amateur</title>
    <link href="../favicon.ico" rel="icon" />
    <link rel="alternate" type="application/atom+xml" title="Rohan's Weblog" href="../feed.xml" />

    <!-- Bootstrap core CSS -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">


    <!-- Custom styles for this template -->
    <link href="../static/css/default.css" rel="stylesheet" />
    <link href="../static/css/highlight.css" rel="stylesheet" />

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script>
      if (typeof(localStorage) === 'object' && localStorage.noAnalytics !== "true") {
        // Google analytics
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-15806710-5', 'auto');
        ga('send', 'pageview');
      }
    </script>
  </head>

  <body>
    <div class="container">
      <div class="header clearfix">
        <nav>
          <ul class="nav nav-pills">
            <a class="superTitle" href="../">
              The Perpetual Amateur
            </a>
          </ul>
        </nav>
        <h1 class="text-muted">VNC over reverse SSH</h1>
      </div>

      <div id="content">
        <div class="meta">
  <em class="date">May 10, 2015</em>
  
  |
  <span class="tags"><a href="../tags/vnc/">vnc</a>, <a href="../tags/ssh/">ssh</a></span>
  
</div>

<div class="post">
  <p>About a year ago, I switched my parents computer (lets call it <code>P</code>) from the pre-installed OS (Windows) to Ubuntu. The primary reason for this switch was it hard for me to debug and fix issues. Things have been smooth after the switch with no issues which I found hard to fix remotely. What specially has worked is my ability to log in to the computer when its on through my VPS and service it.</p>
<h2 id="reverse-ssh">Reverse SSH</h2>
<p>Whenever <code>P</code> starts, it makes a reverse SSH connection to my VPS. I use <a href="https://www.archlinux.org/packages/community/x86_64/autossh/">autossh</a> to monitor and make sure that it is eventually always connected.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="ex">autossh</span> -M 10001 -f -NXYR 10000:localhost:22 vps</code></pre></div>
<p>Here <code>vps</code> is a SSH alias for my personal VPS.</p>
<p>I can tunnel through the VPS and login to <code>P</code> via VPS using the following SSH configuration:</p>
<pre class="config"><code>Host home
     Hostname localhost
     User username
     Port 10000
     ProxyCommand ssh -e none -W %h:%p vps</code></pre>
<p>To log in to <code>P</code> transparently, I can simply do:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="fu">ssh</span> home</code></pre></div>
<p>I use this to resolve most of the issues. Of course it does have the requirement that the system be booted up and connected to a network.</p>
<h2 id="vnc">VNC</h2>
<p>There also can be issues which have to do with the GUI (say browser maintenance) and cannot be done easily over a text SSH session. For those cases, VNC is to rescue. I create a VNC server on <code>P</code> using <a href="https://wiki.archlinux.org/index.php/X11vnc">x11vnc</a> and tunnel the VNC port to my local through SSH. Now, I can access <code>P</code>’s graphical session remotely via a vnc client (mine is <a href="https://www.archlinux.org/packages/community/x86_64/tigervnc/">tigervnc</a>).</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="fu">ssh</span> home -L 5900:localhost:5900 <span class="st">&quot;x11vnc -rfbauth ~/.vnc/passwd -display :0 -noxdamage&quot;</span>
$ <span class="ex">vncviewer</span> localhost::5900 -QualityLevel 3 -CompressLevel 6</code></pre></div>
<p>This method is much better compared to the more common solutions such has Google’s VNC chrome extension or other proprietary services. But they are slow and untrustable 3rd parties. With this way of setting up VNC, everything is protected under SSH connections.</p>


</div>
<em class="meta">
  Any suggestions for the post? You may send me a pull request
  <a href="https://github.com/crodjer/rohanjain.in/tree/master/posts/2015/vnc.mkd">here</a>.
</em>
<!--

<div class="comments">
  <div id="disqus_thread"></div>

  <script type="text/javascript">

    //Disqus
    var disqus_shortname = 'crodjer';

    var disqus_identifier = 'posts/2015/vnc.mkd';
    var disqus_title = 'VNC over reverse SSH';

  </script>
  <script src="http://crodjer.disqus.com/embed.js"></script>
</div>

-->

      </div>

      <footer class="footer">
        <a class="link" href="../">Home</a>
        <a class="link" href="../about/">About</a>
        <a class="link" href="../feed.xml">Feed</a>
        <a class="link" href="https://github.com/crodjer">GitHub</a>

        <span class="credits">
          Site proudly generated with
          <a href="http://github.com/jaspervdj/hakyll">Hakyll</a>.
        </span>
      </footer>
    </div> <!-- /container -->

    <a href="https://github.com/crodjer" class="gh-banner">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/a6677b08c955af8400f44c6298f40e7d19cc5b2d/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" />
    </a>

  </body>

  <script src="//cdnjs.cloudflare.com/ajax/libs/turbolinks/1.3.0/turbolinks.min.js">
  </script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js">
  </script>
  <script>
    document.addEventListener('page:fetch', function() {
      NProgress.start();
    });
    document.addEventListener('page:change', function() {
      NProgress.done();
    });
    document.addEventListener('page:restore', function() {
      NProgress.remove();
    });
  </script>
</html>
