<!doctype html><html lang=en-US><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=author content="Rohan Jain"><meta name=description content="Self Hosting Gitlab using Quadlets | Rohan's Personal Web Blog."><meta property="og:title" content="Self Hosting Gitlab using Quadlets"><meta property="og:type" content="article"><meta property="article:published_time" content="2025-10-26T09:27:21+05:30"><meta property="article:modified_time" content="2025-10-26T09:27:21+05:30"><title>Self Hosting Gitlab using Quadlets</title><link rel=canonical href=/gitlab/><link rel=stylesheet href=/css/main.min.97ffe0e39b9819392033e2635f05ec47c705d94936b7483bb66889dbf15d7a90.css><link rel="shortcut icon" href=/img/favicon.ico></head><body lang=en><header><a href=/>The Perpetual Amature</a><nav><ul><li><a href=/>Home</a></li><li><a href=/about/>About</a></li></ul></nav></header><main><article><header><h1>Self Hosting Gitlab using Quadlets</h1><small><time datetime=2025-10-26 title='Sun Oct 26 2025 09:27:21 +0530'>Oct 26, 2025</time>
| 3 minutes read</small></header><h3 id=what-are-quadlets><a class=heading-anchor href=#what-are-quadlets aria-label="Permalink to What are Quadlets?">§</a>
What are Quadlets?</h3><p>I self-host most of my services important to me personally. Lately, I have been
using <a href=https://www.redhat.com/en/blog/quadlet-podman>Quadlets</a> for this. I came
across the concept of Quadlets from Immich.</p><p>For git repositories, I have been just using <code>git init --bare</code> in a server and
plain SSH to work them: <code>git clone git@&lt;user>:sources/&lt;repo></code>.</p><p>Having used Quadlets with Immich, I thought of trying using them with Gitlab.
And this post talks about how to do that.</p><h2 id=podman-setup><a class=heading-anchor href=#podman-setup aria-label="Permalink to Podman Setup">§</a>
Podman Setup</h2><p>Before setting up the quadlet, there are some packages required for <code>podman</code> to
function fine with networking. I installed: <code>aardvark-dns, dbus-user-session, passt, podman, uidmap</code>. But some packages from this list may not be needed for
<code>gitlab</code> as it’s just a single container.</p><h2 id=gitlab-setup><a class=heading-anchor href=#gitlab-setup aria-label="Permalink to Gitlab Setup">§</a>
Gitlab Setup</h2><p>Basically, all that we need to do is define:
<code>.config/containers/systemd/gitlab.container</code></p><pre><code class=language-systemd>[Unit]
Description=GitLab Container
After=network-online.target
Wants=network-online.target
# This ensures that the container won't start unless the directories are
# available.
# I need this since my file system is double encrypted - FDE with LUKS for
# system) and file-level encryption, managed by `ansible`. You might not need
# this if this path is guaranteed to be available.
ConditionPathExists=&lt;path-to-data-directory&gt;/repositories

[Container]
Image=docker.io/gitlab/gitlab-ce:latest
ContainerName=gitlab
ShmSize=256m

PublishPort=3939:80
PublishPort=2222:22

Volume=&lt;path-to-data-directory&gt;/repositories/config:/etc/gitlab:Z
Volume=&lt;path-to-data-directory&gt;/repositories/logs:/var/log/gitlab:Z
Volume=&lt;path-to-data-directory&gt;/repositories/data:/var/opt/gitlab:Z

# Explaining, GITLAB_OMNIBUS_CONFIG
# `external_url`: I have an external reverse proxy managed by my Ansible roles.
# `nginx['listen_port']: Just listen on `80`, so that I can manage the actual
# SSL from my reverse proxy outside.
# `nginx['listen_https']: Ask `nginx` to not do SSL inside the container.
# `gitlab_rails['gitlab_shell_ssh_port']: The port I use for listening for SSH.
Environment=GITLAB_OMNIBUS_CONFIG=&quot;external_url 'https://&lt;my-hostname&gt;'; nginx['listen_port'] = 80; nginx['listen_https'] = false; gitlab_rails['gitlab_shell_ssh_port'] = 2222;&quot;

[Service]
Restart=always
TimeoutStartSec=900

[Install]
WantedBy=default.target
</code></pre><h3 id=gitlab-omnibus-config><a class=heading-anchor href=#gitlab-omnibus-config aria-label="Permalink to Gitlab Omnibus Config">§</a>
Gitlab Omnibus Config</h3><p>There&rsquo;s quite a bit going on in the <code>GITLAB_OMNIBUS_CONFIG</code>. My Ansible setup
takes care of setting up SSL and exposing it over <code>443</code>, so I don&rsquo;t forward that
to <code>gitlab</code>. That&rsquo;s what I configure <code>external_url</code> to. The <code>nginx</code> specific
configuration asks nginx to not do SSL and listen on <code>80</code> which I forward to
3939 outside. For SSH, the port I forward is <code>2222</code> as my node itself does its
ssh on <code>22</code>.</p><h3 id=starting-the-service><a class=heading-anchor href=#starting-the-service aria-label="Permalink to Starting the Service">§</a>
Starting the Service</h3><p>Once this unit file is set up, you should be able to start it with:</p><pre><code class=language-bash>$ systemctl --user daemon-reload
$ systemctl --user enable --now gitlab.service
</code></pre><p>For the first launch, getting the image will take some time. You can look at the
status using:
<code>systemctl status --user gitlab</code>.</p><p>Once it is up and running, use <code>journalctl --user -fu gitlab</code> to look at the
service logs.</p><p>Now, ideally if you set up your reverse proxy right, you should be able to access
<code>gitlab</code> over your hostname.</p><h3 id=gitlab-configuration><a class=heading-anchor href=#gitlab-configuration aria-label="Permalink to Gitlab Configuration">§</a>
Gitlab Configuration</h3><p>We do need to take care of one more thing, that is the root password. You can
find it under your config directory in the file <code>initial_root_password</code>. Use this
password with the username <code>root</code> for further configuration as per
<a href=https://docs.gitlab.com/install/next_steps/>next steps documentation</a>.</p><h2 id=why-quadlets><a class=heading-anchor href=#why-quadlets aria-label="Permalink to Why Quadlets?">§</a>
Why Quadlets?</h2><p>Podman and Quadlets can manage a significantly more complex configuration (for
instance, Immich via
<a href=https://github.com/linux-universe/immich-podman-quadlets/blob/main/README.md>this handbook</a>).
I find this much easier to manage than <code>docker-compose.yaml</code>, which isn&rsquo;t
ergonomic with Ansible. Additionally, <code>podman</code> doesn&rsquo;t need any daemon running
like Docker for it to be useful.</p></article></main><footer><a href=/blog>All Posts</a>
<a href=//github.com/crodjer target=_blank rel=noopener>Github</a>
<a href=//linkedin.com/in/crodjer target=_blank rel=noopener>Linkedin</a>
<a href=//twitter.com/__crodjer__ target=_blank rel=noopener>Twitter</a></footer><script data-goatcounter=https://t.rohanjain.in/count async src=/js/count.min.4e3257a9873dba863f309fe89287c9f6e962d7be1758704f13b2608e58008e5f.js></script><noscript><img src="https://t.rohanjain.in/count?p=%2fgitlab%2f&t=Self%20Hosting%20Gitlab%20using%20Quadlets"></noscript></body></html>