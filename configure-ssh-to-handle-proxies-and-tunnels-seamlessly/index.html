<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Configure ssh to handle proxies and tunnels seamlessly - Rohan's Weblog</title>
        <link href='http://fonts.googleapis.com/css?family=Droid+Sans:400,700' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" type="text/css" href="/static/css/default.css" />
        <link rel="stylesheet" type="text/css" href="/static/css/highlight.css" />
        <link rel="alternate" type="application/rss+xml" title="Rohan's Weblog" href="/rss.xml" />
        <link href="/favicon.ico" rel="shortcut icon"/>

    </head>
    <body>
        <div id="header">
            <h1 class="superTitle"><a href="/">Rohan's Weblog</a></h1>
            <h1 class="title">Configure ssh to handle proxies and tunnels seamlessly</h1>
        </div>
        <div id="content">
            <span class="meta">
  by <em>crodjer</em> on <strong>August 27, 2011</strong>, tagged <a href="/tags/hacking.html">hacking</a>, <a href="/tags/ssh.html">ssh</a>
</span>
<hr class="clear"/>
<div id="post">
  
<p>Recently I opened up on the port <em>443</em> over my EC2 instance (more or less like a VPS), so that I can access it through any firewalled proxy too. Apart from getting SSH running to a machine from outside world, I did some cool configuration to have ssh deal with with various remote hosts automatically. It uses <em>the right</em> proxy settings according the host being accessed.</p>
<p>All the stuff which runs over ssh (like <em>scp</em>, <em>git</em> etc.) also work the way they are supposed to, following the ssh configuration.</p>
<p>To get this to work you need to have <em>corkscrew</em> and <em>netcat</em> (the swiss army knife) already installed.</p>
<p>Here is how it goes:<br /><code>File ~/ssh/config:</code></p>
<pre class="sourceCode apache"><code class="sourceCode apache"><span class="co"># Let me access local remotes directly.</span>
Host 127.0.0.1, 10.*
    ProxyCommand none

<span class="co"># Github lets you ssh over port 443 too, utilize that instead of tunneling</span>
<span class="co"># through remote computer</span>
Host github.com
    Hostname ssh.github.com
    User<span class="st"> git</span>
    ProxyCommand corkscrew 10.3.100.211 8080 %h %p
    Port 443
    Hostname ssh.github.com

<span class="co"># Let me ssh onto my ec2 instance, which has full network access, through a</span>
<span class="co"># http proxy.</span>
Host ecc.rohanjain.in
    ProxyCommand corkscrew 10.3.100.211 8080 %h %p
    Port 443
    ServerAliveInterval 600

<span class="co"># All the rest should connect through an ssh connection over the ec2 instance.</span>
Host *
    ProxyCommand ssh -q -a -x -p 443 ecc.rohanjain.in nc %h %p</code></pre>
</div>

<div class="comments">
  <div id="disqus_thread"></div>

  <script type="text/javascript">

    //Google analytics
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-15806710-5']);
    _gaq.push(['_trackPageview']);

    //Disqus
    var disqus_shortname = 'crodjer';

    var disqus_identifier = 'configure-ssh-to-handle-proxies-and-tunnels-seamlessly';
    var disqus_title = 'Configure ssh to handle proxies and tunnels seamlessly';

  </script>
  <script src="http://crodjer.disqus.com/embed.js"></script>

  <noscript>
    Please enable JavaScript to view comments
  </noscript>

</div>

        </div>
        <div id="footer">
            <hr/>
            <a class="link" href="/">Home</a>
            <a class="link" href="/about/">About</a>
            <a class="link" href="/sitemap.xml">Sitemap</a>
            <a class="link" href="/feed.xml">Feed</a>
            <span class="credits">Site proudly generated using
                <a href="http://github.com/jaspervdj/hakyll">Hakyll</a><span>
        </div>

        <script type="text/javascript" src="http://www.google-analytics.com/ga.js"></script>
    </body>
</html>
