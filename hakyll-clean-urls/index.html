<!doctype html><html lang=en-US><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=author content="Rohan Jain"><meta name=description content="Clean URLs with Hakyll | Rohan's Personal Web Blog."><meta property="og:title" content="Clean URLs with Hakyll"><meta property="og:type" content="article"><meta property="article:published_time" content="2015-08-30T00:00:00+00:00"><meta property="article:modified_time" content="2015-08-30T00:00:00+00:00"><title>Clean URLs with Hakyll</title><link rel=canonical href=/hakyll-clean-urls/><link rel=stylesheet href=/css/main.min.97ffe0e39b9819392033e2635f05ec47c705d94936b7483bb66889dbf15d7a90.css><link rel="shortcut icon" href=/img/favicon.ico></head><body lang=en><header><a href=/>The Perpetual Amature</a><nav><ul><li><a href=/>Home</a></li><li><a href=/about/>About</a></li></ul></nav></header><main><h1>Clean URLs with Hakyll</h1><p>The URLs generated by <a href=http://jaspervdj.be/hakyll/>Hakyll</a>, by default also include a
<code>.html</code> extension. I have never been a fan of this. When things in
reality are driven by the <code>Content-Type</code> header, it is absolutely
redundant.</p><p>Hakyll provides all the utilities with which we can get cleaner URLs,
like <a href=.>this page&rsquo;s</a>. For this, I rely on the fact that most of the
web servers automatically serve <code>/foo/index.html</code> for the URL
<code>/foo/</code>. To generate <em>clean</em> paths, I define a custom route -
<code>cleanRoute</code>:</p><pre><code class=language-haskell>cleanRoute :: Routes
cleanRoute = customRoute createIndexRoute
  where
    createIndexRoute ident = takeDirectory p &lt;/&gt; takeBaseName p &lt;/&gt; &quot;index.html&quot;
                            where p = toFilePath ident
</code></pre><p>This can now be used in in rule definition:</p><pre><code class=language-haskell>  match &quot;pages/*&quot; $ do
         route   $ cleanRoute
         -- the compiler follows
</code></pre><p>With this, a path say <code>/pages/about.html</code> will be generated as
<code>/pages/about/index.html</code>, hence solving the generation problem. We
are only partially done though. The links that Hakyll generates will
also include the <code>/index.html</code> suffix in every URL. To get rid of that
we define a set of functions:</p><pre><code class=language-haskell>cleanIndexUrls :: Item String -&gt; Compiler (Item String)
cleanIndexUrls = return . fmap (withUrls cleanIndex)

cleanIndexHtmls :: Item String -&gt; Compiler (Item String)
cleanIndexHtmls = return . fmap (replaceAll pattern replacement)
    where
      pattern = &quot;/index.html&quot;
      replacement = const &quot;/&quot;

cleanIndex :: String -&gt; String
cleanIndex url
    | idx `isSuffixOf` url = take (length url - length idx) url
    | otherwise            = url
  where idx = &quot;index.html&quot;
</code></pre><p><code>cleanIndexUrls</code> and <code>cleanIndexHtmls</code> strip out <code>/index.html</code> from
all the anchor tags and complete text respectively. These can be used
over a page&rsquo;s compiler like this:</p><pre><code class=language-haskell>         compile $ pandocCompiler
            &gt;&gt;= loadAndApplyTemplate &quot;templates/page.html&quot; pageCtx
            &gt;&gt;= saveSnapshot &quot;content&quot;
            &gt;&gt;= loadAndApplyTemplate &quot;templates/default.html&quot; pageCtx
            &gt;&gt;= relativizeUrls
            &gt;&gt;= cleanIndexUrls -- cleanup href in all anchor tags.
</code></pre><blockquote><p>This functionality is being used by <a href=https://github.com/crodjer/rohanjain.in/blob/master/site.hs>this blog</a> and
<a href=https://github.com/irneh/workforpizza/blob/master/site.hs>irneh/workforpizza</a> off which this blog is actually
based.</p></blockquote></main><footer><a href=/blog>All Posts</a>
<a href=//github.com/crodjer target=_blank rel=noopener>Github</a>
<a href=//linkedin.com/in/crodjer target=_blank rel=noopener>Linkedin</a>
<a href=//twitter.com/__crodjer__ target=_blank rel=noopener>Twitter</a></footer><script data-goatcounter=https://t.rohanjain.in/count async src=/js/count.min.4e3257a9873dba863f309fe89287c9f6e962d7be1758704f13b2608e58008e5f.js></script><noscript><img src="https://t.rohanjain.in/count?p=%2fhakyll-clean-urls%2f&t=Clean%20URLs%20with%20Hakyll"></noscript></body></html>